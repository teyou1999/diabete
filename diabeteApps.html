<link href="bootstrap441/dist/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<link rel="stylesheet" href="sign-up.css">
<!------ Include the above in your HEAD tag ---------->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs/dist/tf.min.js"> </script>

<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<body>
   <div class="container">
      <div class="col-md-6 mx-auto text-center">
         <div class="header-title">
            <h1 class="wv-heading--title">
               Bienvenu sur DiabetApps
            </h1>
            <h2 class="wv-heading--subtitle">
               Realisez votre diagnostique du diabete en toute confidentialite
            </h2>
         </div>
      </div>
      <div class="row">
         <div class="col-md-4 mx-auto">
            <div class="myform form ">
               <form>
                   <div class="form-group">
                     <input type="text" name="old" id="old"  class="form-control my-input"  placeholder="old">
                  </div>
                  <div class="form-group">
                     <input type="text" name="pregnancies" id="pregnancies"  class="form-control my-input"  placeholder="Pregnancies">
                  </div>
                  <div class="form-group">
                     <input type="name" name="glucose" id="glucose" class="form-control my-input"  placeholder="Glucose">
                  </div>
                  <div class="form-group">
                     <input type="name" name="blood" id="blood" class="form-control my-input"  placeholder="BloodPressure">
                  </div>
                 <div class="form-group">
                     <input type="name" name="skin" id="skin" class="form-control my-input"  placeholder="SkinThickness">
                  </div> 
                <div class="form-group">
                     <input type="name" name="imc" id="imc" class="form-control my-input"  placeholder="IMC">
                  </div>  
                  <div class="form-group">
                     <input type="name" name="dpf" id="dpf" class="form-control my-input"  placeholder="DiabetesPedigreeFunction">
                  </div>
                  <div class="text-center ">
                     <button type="button" id="btn-sub" class=" btn btn-block send-button tx-tfm">Diagnostique</button>
                  </div>
                  <p class="small mt-3">Nous proposons une redaction etendue<a href="https://www.passeportsante.net/fr/Maux/Problemes/Fiche.aspx?doc=diabete-type2-pm-symptomes-du-diabete-de-type-2" class="ps-hero__content__link">les symptomes et causes</a> et <a href="https://www.passeportsante.net/fr/Maux/Problemes/Fiche.aspx?doc=diabete-type2-pm-traitements-medicaux-du-diabete-de-type-2">le traitements</a>.
                  </p>
               </form>
            </div>
         </div>
      </div>
   </div>
   <script defer>
       document.querySelector("#btn-sub").addEventListener("click", diagnostique)
       class JSONHandler {
            constructor(jsonString) {
                this.jsonString = jsonString;
            }
            async load() {
                const modelJSON = JSON.parse(this.jsonString);
                const modelArtifacts = {
                    modelTopology: modelJSON.modelTopology,
                    format: modelJSON.format,
                    generatedBy: modelJSON.generatedBy,
                    convertedBy: modelJSON.convertedBy
                };
                if (modelJSON.weightsManifest != null) {
                // load weights (if they exist)
                }
                if (modelJSON.trainingConfig != null) {
                    modelArtifacts.trainingConfig = modelJSON.trainingConfig;
                }
                if (modelJSON.userDefinedMetadata != null) {
                    modelArtifacts.userDefinedMetadata = modelJSON.userDefinedMetadata;
                }
                return modelArtifacts;
            }
        }

       //import * as tf from '@tensorflow/tfjs';
        async function diagnostique(e){
            // console.log(e)
            // JavaScript

            const modelJson = '{"format": "layers-model", "generatedBy": "keras v2.8.0", "convertedBy": "TensorFlow.js Converter v3.15.0", "modelTopology": {"keras_version": "2.8.0", "backend": "tensorflow", "model_config": {"class_name": "Sequential", "config": {"name": "sequential", "layers": [{"class_name": "InputLayer", "config": {"batch_input_shape": [null, 7], "dtype": "float32", "sparse": false, "ragged": false, "name": "dense_input"}}, {"class_name": "Dense", "config": {"name": "dense", "trainable": true, "batch_input_shape": [null, 7], "dtype": "float32", "units": 512, "activation": "relu", "use_bias": true, "kernel_initializer": {"class_name": "GlorotUniform", "config": {"seed": null}}, "bias_initializer": {"class_name": "Zeros", "config": {}}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}}, {"class_name": "Dense", "config": {"name": "dense_1", "trainable": true, "dtype": "float32", "units": 512, "activation": "relu", "use_bias": true, "kernel_initializer": {"class_name": "GlorotUniform", "config": {"seed": null}}, "bias_initializer": {"class_name": "Zeros", "config": {}}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}}, {"class_name": "Dense", "config": {"name": "dense_2", "trainable": true, "dtype": "float32", "units": 512, "activation": "relu", "use_bias": true, "kernel_initializer": {"class_name": "GlorotUniform", "config": {"seed": null}}, "bias_initializer": {"class_name": "Zeros", "config": {}}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}}, {"class_name": "Dense", "config": {"name": "dense_3", "trainable": true, "dtype": "float32", "units": 1, "activation": "sigmoid", "use_bias": true, "kernel_initializer": {"class_name": "GlorotUniform", "config": {"seed": null}}, "bias_initializer": {"class_name": "Zeros", "config": {}}, "kernel_regularizer": null, "bias_regularizer": null, "activity_regularizer": null, "kernel_constraint": null, "bias_constraint": null}}]}}, "training_config": {"loss": "binary_crossentropy", "metrics": [[{"class_name": "MeanMetricWrapper", "config": {"name": "binary_accuracy", "dtype": "float32", "fn": "binary_accuracy"}}]], "weighted_metrics": null, "loss_weights": null, "optimizer_config": {"class_name": "Adam", "config": {"name": "Adam", "learning_rate": 0.0010000000474974513, "decay": 0.0, "beta_1": 0.8999999761581421, "beta_2": 0.9990000128746033, "epsilon": 1e-07, "amsgrad": false}}}}, "weightsManifest": [{"paths": ["group1-shard1of1.bin"], "weights": [{"name": "dense/kernel", "shape": [7, 512], "dtype": "float32"}, {"name": "dense/bias", "shape": [512], "dtype": "float32"}, {"name": "dense_1/kernel", "shape": [512, 512], "dtype": "float32"}, {"name": "dense_1/bias", "shape": [512], "dtype": "float32"}, {"name": "dense_2/kernel", "shape": [512, 512], "dtype": "float32"}, {"name": "dense_2/bias", "shape": [512], "dtype": "float32"}, {"name": "dense_3/kernel", "shape": [512, 1], "dtype": "float32"}, {"name": "dense_3/bias", "shape": [1], "dtype": "float32"}]}]}'
            const handler = new JSONHandler(modelJson)
            const model =  await tf.loadLayersModel(handler);
            //console.log(model)
            pregnancies=parseFloat(document.getElementById("pregnancies").value);
            glucose=parseFloat(document.getElementById("glucose").value);
            imc=parseFloat(document.getElementById("imc").value);
            blood=parseFloat(document.getElementById("blood").value);
            skin=parseFloat(document.getElementById("skin").value);
            dpf=parseFloat(document.getElementById("dpf").value);
            old=parseFloat(document.getElementById("old").value);
           // x = ([[, 87, 80, 29.15, 23.2, 0.084, 32]]);
            //console.log(x);


            // Create a rank-2 tensor (matrix) matrix tensor from a multidimensional array.
             const a = tf.tensor(([[pregnancies,glucose,blood,skin,dpf,old,imc]]));
             //console.log('shape:', a.shape);
             a.array().then(array => console.log(array));
             // Returns the flattened data that backs the tensor.
            a.data().then(data => console.log(data));
            
            

              // Or you can create a tensor from a flat array and specify a shape.
              /*const shape = [2, 2];
              const b = tf.tensor([1, 2, 3, 4], shape);
              console.log('shape:', b.shape);
              b.print();*/
            
            //const dataArr = tf.tensor2d([pregnancies,glucose,blood,skin,imc,dpf,old], [1,7])
            //dataArr.reshape([1, 7]).print()
            //console.log(dataArr.shape)
           // const data=tf.tensor([dataArr]);
            // x.reshape([1, 7]).print();
            const b=tf.tensor(([[6, 87, 80, 29.15, 23.2, 0.084, 32]]));
            const result = model.predict(a);
             console.log(result.print())
              alert(" la patient a une probabilite de "+result+" d' avoir le diabete");
        }

   </script>
</body>